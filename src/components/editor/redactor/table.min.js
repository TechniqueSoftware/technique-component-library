!(function (r) { r.add('plugin', 'table', { translations: { en: { table: 'Table', 'insert-table': 'Insert table', 'insert-row-above': 'Insert row above', 'insert-row-below': 'Insert row below', 'insert-column-left': 'Insert column left', 'insert-column-right': 'Insert column right', 'add-head': 'Add head', 'delete-head': 'Delete head', 'delete-column': 'Delete column', 'delete-row': 'Delete row', 'delete-table': 'Delete table' } }, init (e) { this.app = e, this.lang = e.lang, this.opts = e.opts, this.caret = e.caret, this.editor = e.editor, this.toolbar = e.toolbar, this.component = e.component, this.inspector = e.inspector, this.insertion = e.insertion, this.selection = e.selection }, ondropdown: { table: { observe (e) { this._observeDropdown(e) } } }, onbottomclick () { this.insertion.insertToEnd(this.editor.getLastNode(), 'table') }, start () { const e = { observe: 'table', 'insert-table': { title: this.lang.get('insert-table'), api: 'plugin.table.insert' }, 'insert-row-above': { title: this.lang.get('insert-row-above'), classname: 'redactor-table-item-observable', api: 'plugin.table.addRowAbove' }, 'insert-row-below': { title: this.lang.get('insert-row-below'), classname: 'redactor-table-item-observable', api: 'plugin.table.addRowBelow' }, 'insert-column-left': { title: this.lang.get('insert-column-left'), classname: 'redactor-table-item-observable', api: 'plugin.table.addColumnLeft' }, 'insert-column-right': { title: this.lang.get('insert-column-right'), classname: 'redactor-table-item-observable', api: 'plugin.table.addColumnRight' }, 'add-head': { title: this.lang.get('add-head'), classname: 'redactor-table-item-observable', api: 'plugin.table.addHead' }, 'delete-head': { title: this.lang.get('delete-head'), classname: 'redactor-table-item-observable', api: 'plugin.table.deleteHead' }, 'delete-column': { title: this.lang.get('delete-column'), classname: 'redactor-table-item-observable', api: 'plugin.table.deleteColumn' }, 'delete-row': { title: this.lang.get('delete-row'), classname: 'redactor-table-item-observable', api: 'plugin.table.deleteRow' }, 'delete-table': { title: this.lang.get('delete-table'), classname: 'redactor-table-item-observable', api: 'plugin.table.deleteTable' } }; const t = { title: this.lang.get('table') }; const n = this.toolbar.addButtonBefore('link', 'table', t); n.setIcon('<i class="re-icon-table"></i>'), n.setDropdown(e) }, insert () { for (var e = this.component.create('table'), t = 0; t < 2; t++)e.addRow(3); e = this.insertion.insertHtml(e), this.caret.setStart(e) }, addRowAbove () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); const n = e.addRowTo(t, 'before'); this.caret.setStart(n) } }, addRowBelow () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); const n = e.addRowTo(t, 'after'); this.caret.setStart(n) } }, addColumnLeft () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); this.selection.save(), e.addColumnTo(t, 'left'), this.selection.restore() } }, addColumnRight () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); this.selection.save(), e.addColumnTo(t, 'right'), this.selection.restore() } }, addHead () { const e = this._getComponent(); e && (this.selection.save(), e.addHead(), this.selection.restore()) }, deleteHead () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); r.dom(t).closest('thead').length !== 0 ? (e.removeHead(), this.caret.setStart(e)) : (this.selection.save(), e.removeHead(), this.selection.restore()) } }, deleteColumn () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); const n = r.dom(t).closest('td, th'); const i = n.nextElement().get(); const o = n.prevElement().get(); e.removeColumn(t), i ? this.caret.setStart(i) : o ? this.caret.setEnd(o) : this.deleteTable() } }, deleteRow () { const e = this._getComponent(); if (e) { const t = this.selection.getCurrent(); const n = r.dom(t).closest('tr'); const i = n.nextElement().get(); const o = n.prevElement().get(); const a = r.dom(t).closest('thead'); e.removeRow(t), i ? this.caret.setStart(i) : o ? this.caret.setEnd(o) : a.length !== 0 ? (e.removeHead(), this.caret.setStart(e)) : this.deleteTable() } }, deleteTable () { const e = this._getTable(); e && this.component.remove(e) }, _getTable () { const e = this.selection.getCurrent(); const t = this.inspector.parse(e); if (t.isTable()) return t.getTable() }, _getComponent () { const e = this.selection.getCurrent(); const t = this.inspector.parse(e); if (t.isTable()) { const n = t.getTable(); return this.component.create('table', n) } }, _observeDropdown (e) { const t = this._getTable(); const n = e.getItemsByClass('redactor-table-item-observable'); const i = e.getItem('insert-table'); t ? (this._observeItems(n, 'enable'), i.disable()) : (this._observeItems(n, 'disable'), i.enable()) }, _observeItems (e, t) { for (let n = 0; n < e.length; n++)e[n][t]() } }) }(Redactor)), (function (r) { r.add('class', 'table.component', { mixins: ['dom', 'component'], init (e, t) { return this.app = e, t && void 0 !== t.cmnt ? t : this._init(t) }, addHead () { this.removeHead(); const e = this.$element.find('tr').first().children('td, th').length; const t = r.dom('<thead>'); const n = this._buildRow(e, '<th>'); t.append(n), this.$element.prepend(t) }, addRow (e) { const t = this._buildRow(e); return this.$element.append(t), t }, addRowTo (e, t) { return this._addRowTo(e, t) }, addColumnTo (e, o) { const t = r.dom(e); const n = t.closest('tr'); const i = t.closest('td, th'); let a = 0; n.find('td, th').each((e, t) => { e === i.get() && (a = t) }), this.$element.find('tr').each(e => { const t = r.dom(e).find('td, th').get(a); const n = r.dom(t); const i = n.clone(); i.html('<div data-redactor-tag="tbr"></div>'), o === 'right' ? n.after(i) : n.before(i) }) }, removeHead () { const e = this.$element.find('thead'); e.length !== 0 && e.remove() }, removeRow (e) { r.dom(e).closest('tr').remove() }, removeColumn (e) { const t = r.dom(e); const n = t.closest('tr'); const i = t.closest('td, th'); let o = 0; n.find('td, th').each((e, t) => { e === i.get() && (o = t) }), this.$element.find('tr').each(e => { const t = r.dom(e).find('td, th').get(o); r.dom(t).remove() }) }, _init (e) { let t; let n; if (void 0 !== e) { const i = r.dom(e); const o = i.get(); const a = i.closest('figure'); a.length !== 0 ? n = (t = a).find('table').get() : o.tagName === 'TABLE' && (n = o) } this._buildWrapper(t), this._buildElement(n), this._initWrapper() }, _addRowTo (e, t) { const n = r.dom(e).closest('tr'); if (n.length !== 0) { const i = n.children('td, th').length; const o = this._buildRow(i); return n[t](o), o } }, _buildRow (e, t) { t = t || '<td>'; for (var n = r.dom('<tr>'), i = 0; i < e; i++) { const o = r.dom(t); o.attr('contenteditable', !0), o.html('<div data-redactor-tag="tbr"></div>'), n.append(o) } return n }, _buildElement (e) { e ? this.$element = r.dom(e) : (this.$element = r.dom('<table>'), this.append(this.$element)) }, _buildWrapper (e) { e = e || '<figure>', this.parse(e) }, _initWrapper () { this.addClass('redactor-component'), this.attr({ 'data-redactor-type': 'table', tabindex: '-1', contenteditable: !1 }), this.app.detector.isIe() && this.removeAttr('contenteditable') } }) }(Redactor))
